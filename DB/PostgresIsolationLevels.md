# üìå –£—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä –¥–ª—è —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è

## 1. –ß—Ç–æ —Ç–∞–∫–æ–µ —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏?

**–£—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏ (Isolation Level)** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –°–£–ë–î, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∞—è, –∫–∞–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏.  
–¶–µ–ª—å: –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É **–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é** –∏ **–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –¥–∞–Ω–Ω—ã—Ö**.

---

## 2. 4 —É—Ä–æ–≤–Ω—è –∏–∑–æ–ª—è—Ü–∏–∏ (ANSI SQL)

### –£—Ä–æ–≤–µ–Ω—å 1: READ UNCOMMITTED
- **–ì—Ä—è–∑–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (Dirty Read):** –î–∞ ‚úÖ
- **–ù–µ–ø–æ–≤—Ç–æ—Ä—è–µ–º–æ–µ —á—Ç–µ–Ω–∏–µ (Non-Repeatable Read):** –î–∞ ‚úÖ
- **–§–∞–Ω—Ç–æ–º—ã (Phantoms):** –î–∞ ‚úÖ

**–ü—Ä–∏–º–µ—Ä:**  
```sql
-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 1
BEGIN;
UPDATE users SET balance = 100 WHERE id = 1; -- –ù–µ –∫–æ–º–º–∏—Ç–∏—Ç

-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 2 (READ UNCOMMITTED)
BEGIN;
SELECT balance FROM users WHERE id = 1; -- –£–≤–∏–¥–∏—Ç 100 (–≥—Ä—è–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å PostgreSQL:**  
`READ UNCOMMITTED` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ `READ COMMITTED` ([–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://www.postgresql.org/docs/current/transaction-iso.html)).

---

### –£—Ä–æ–≤–µ–Ω—å 2: READ COMMITTED (–¥–µ—Ñ–æ–ª—Ç –≤ PostgreSQL)
- **–ì—Ä—è–∑–Ω–æ–µ —á—Ç–µ–Ω–∏–µ:** –ù–µ—Ç ‚ùå
- **–ù–µ–ø–æ–≤—Ç–æ—Ä—è–µ–º–æ–µ —á—Ç–µ–Ω–∏–µ:** –î–∞ ‚úÖ
- **–§–∞–Ω—Ç–æ–º—ã:** –î–∞ ‚úÖ

**–ü—Ä–∏–º–µ—Ä:**  
```sql
-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 1
BEGIN;
UPDATE users SET balance = 200 WHERE id = 1;
COMMIT;

-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 2 (READ COMMITTED)
BEGIN;
SELECT balance FROM users WHERE id = 1; -- –í–µ—Ä–Ω–µ—Ç 100 (—Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ)
-- –ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ 1:
SELECT balance FROM users WHERE id = 1; -- –í–µ—Ä–Ω–µ—Ç 200 (–Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ)
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ë–æ–ª—å—à–µ —á—Ç–µ–Ω–∏–π, —á–µ–º –∑–∞–ø–∏—Å–µ–π.
- –î–æ–ø—É—Å—Ç–∏–º—ã –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ä–∞–º–∫–∞—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

---

### –£—Ä–æ–≤–µ–Ω—å 3: REPEATABLE READ
- **–ì—Ä—è–∑–Ω–æ–µ —á—Ç–µ–Ω–∏–µ:** –ù–µ—Ç ‚ùå
- **–ù–µ–ø–æ–≤—Ç–æ—Ä—è–µ–º–æ–µ —á—Ç–µ–Ω–∏–µ:** –ù–µ—Ç ‚ùå
- **–§–∞–Ω—Ç–æ–º—ã:** –î–∞ ‚úÖ (–Ω–æ –≤ PostgreSQL ‚Äî –Ω–µ—Ç! üöÄ)

**–ü—Ä–∏–º–µ—Ä –≤ PostgreSQL:**  
```sql
-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 1 (REPEATABLE READ)
BEGIN;
SELECT * FROM users WHERE age > 30; -- –í–µ—Ä–Ω–µ—Ç 10 –∑–∞–ø–∏—Å–µ–π

-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 2
INSERT INTO users (age) VALUES (35); COMMIT;

-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 1
SELECT * FROM users WHERE age > 30; -- –í—Å–µ —Ä–∞–≤–Ω–æ 10 –∑–∞–ø–∏—Å–µ–π (—Ñ–∞–Ω—Ç–æ–º–æ–≤ –Ω–µ—Ç)
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å PostgreSQL:**  
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç **Snapshot Isolation** ‚Üí –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ñ–∞–Ω—Ç–æ–º—ã.  
–≠—Ç–æ **–Ω–µ –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É ANSI**, –Ω–æ –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ.

---

### –£—Ä–æ–≤–µ–Ω—å 4: SERIALIZABLE
- **–ì—Ä—è–∑–Ω–æ–µ —á—Ç–µ–Ω–∏–µ:** –ù–µ—Ç ‚ùå
- **–ù–µ–ø–æ–≤—Ç–æ—Ä—è–µ–º–æ–µ —á—Ç–µ–Ω–∏–µ:** –ù–µ—Ç ‚ùå
- **–§–∞–Ω—Ç–æ–º—ã:** –ù–µ—Ç ‚ùå

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**  
–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Ç–∞–∫, –∫–∞–∫ –±—É–¥—Ç–æ –æ–Ω–∏ –∑–∞–ø—É—â–µ–Ω—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ.

**–ü—Ä–∏–º–µ—Ä:**  
```sql
-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 1 (SERIALIZABLE)
BEGIN;
SELECT COUNT(*) FROM users WHERE balance > 1000; -- 5

-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 2
INSERT INTO users (balance) VALUES (2000); COMMIT;

-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 1
UPDATE users SET status = 'VIP' WHERE balance > 1000;
-- –ï—Å–ª–∏ SERIALIZABLE: –æ—à–∏–±–∫–∞ "could not serialize access"
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ñ–∏–Ω–∞–Ω—Å—ã, –∞—É–¥–∏—Ç).
- –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.

---

## 3. –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏?

| –£—Ä–æ–≤–µ–Ω—å              | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å | –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è                |
|----------------------|--------------------|-----------------|---------------------------------------|
| **READ COMMITTED**   | –í—ã—Å–æ–∫–∞—è            | –ù–∏–∑–∫–∞—è          | –ë–ª–æ–≥, –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤                 |
| **REPEATABLE READ**  | –°—Ä–µ–¥–Ω—è—è            | –°—Ä–µ–¥–Ω—è—è         | –û—Ç—á–µ—Ç—ã, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞                     |
| **SERIALIZABLE**     | –ù–∏–∑–∫–∞—è             | –í—ã—Å–æ–∫–∞—è         | –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è     |

---

## 4. –£—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ –≤ Hibernate

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ Spring:
```java
@Transactional(isolation = Isolation.REPEATABLE_READ)
public void updateUser(Long userId) {
// ...
}
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —É—Ä–æ–≤–Ω–∏:**
- `Isolation.DEFAULT` (READ COMMITTED –≤ PostgreSQL)
- `Isolation.READ_COMMITTED`
- `Isolation.REPEATABLE_READ`
- `Isolation.SERIALIZABLE`

---

## 5. –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

### –í–æ–ø—Ä–æ—Å 1:
**"–ü–æ—á–µ–º—É –≤ PostgreSQL –Ω–µ—Ç –≥—Ä—è–∑–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è (Dirty Read)?"**

**–û—Ç–≤–µ—Ç:**
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ PostgreSQL –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ **MVCC (Multiversion Concurrency Control)**.
- –î–∞–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ **—Å–Ω–∏–º–∫–∞ (snapshot)** –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
- –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –¥–ª—è —á—Ç–µ–Ω–∏—è.

---

### –í–æ–ø—Ä–æ—Å 2:
**"–ö–∞–∫ REPEATABLE READ –≤ PostgreSQL –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ñ–∞–Ω—Ç–æ–º—ã?"**

**–û—Ç–≤–µ—Ç:**
- PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Snapshot Isolation** –¥–ª—è —É—Ä–æ–≤–Ω—è `REPEATABLE READ`.
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–∏–¥—è—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
- –ù–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –¥—Ä—É–≥–∏–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏, –Ω–µ –≤–∏–¥–Ω—ã (—Ñ–∞–Ω—Ç–æ–º—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è).

---

### –í–æ–ø—Ä–æ—Å 3:
**"–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SERIALIZABLE?"**

**–û—Ç–≤–µ—Ç:**
- –ö–æ–≥–¥–∞ **–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**.
- –ü—Ä–∏–º–µ—Ä—ã:
    - –°–ø–∏—Å–∞–Ω–∏–µ –¥–µ–Ω–µ–≥ —Å –¥–≤—É—Ö —Å—á–µ—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
    - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–∏–ª–µ—Ç–∞ –Ω–∞ —Ä–µ–π—Å.

**–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:**
- –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ `Serialization Failure` ‚Üí –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä—ã (retry logic).

---

## 6. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã

### –î–ª—è —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è:
- **–ì–æ–≤–æ—Ä–∏—Ç–µ –ø—Ä–æ MVCC:**  
  "PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç MVCC, –ø–æ—ç—Ç–æ–º—É –¥–∞–∂–µ –ø—Ä–∏ REPEATABLE READ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è —á—Ç–µ–Ω–∏—è".
- **–£–ø–æ–º—è–Ω–∏—Ç–µ Snapshot Isolation:**  
  "–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –¥—Ä—É–≥–∏—Ö –°–£–ë–î, PostgreSQL –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ñ–∞–Ω—Ç–æ–º—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ REPEATABLE READ".
- **–ü—Ä–∏–º–µ—Ä—ã –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏:**  
  "–í –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ SERIALIZABLE –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –Ω–æ –ø–µ—Ä–µ—à–ª–∏ –Ω–∞ REPEATABLE READ + –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏".

### –í –∫–æ–¥–µ:
- **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –æ—à–∏–±–∫–∏:**  
  ```java
  try {
  someService.updateData();
  } catch (CannotSerializeTransactionException ex) {
  // Retry logic
  }
  ```
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**  
  ```sql
  SELECT * FROM pg_stat_activity WHERE state = 'idle in transaction';
  ```

---

## 7. –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏

‚úÖ –ü–æ–Ω–∏–º–∞—é —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏ –∏–∑–æ–ª—è—Ü–∏–∏.  
‚úÖ –ó–Ω–∞—é, –∫–∞–∫ PostgreSQL –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç REPEATABLE READ.  
‚úÖ –ú–æ–≥—É –æ–±—ä—è—Å–Ω–∏—Ç—å, –ø–æ—á–µ–º—É SERIALIZABLE ‚Äî —ç—Ç–æ –Ω–µ –≤—Å–µ–≥–¥–∞ "–∑–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç".  
‚úÖ –£–º–µ—é –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ –≤ Spring/Hibernate.  
‚úÖ –ó–Ω–∞—é, –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏.