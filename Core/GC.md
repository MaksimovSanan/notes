# GC

## Теория о поколениях

Подавляющее большинство объектов создаются на очень короткое время, они становятся ненужными практически сразу после их
первого использования.

С учетом такого разделения куча делится на __младшее поколение (young generation)__ и __старшее поколение (old
generation)__.

Соответственно, процессы сборки мусора разделяются на __малую сборку (minor GC)__ и __полную сборку (full GC)__.

## Виды GC:

1. __Epsilon GC__ (experimental). Не чистит мусор, запрашивет память и падает с OutOfMemoryError. Используется как
   эталон, для
   сравнения с другими GC.
2. __Serial GC__. Первый сборщик мусора для Java. __Однопоточный__ - для устройств в одним ядром процессора. Вся
   работа - одна большая Stop The World пауза.
    - _Использование Serial GC включается опцией __-XX:+UseSerualGC___
    - Принцип работы: куча делится на __младшее поколение__ (_Eden_, _S0 (Survival0)_, _S1 (Survival1)_) и __Старшее
      поколение__ (_Tenured_).
        - Малая сборка: при заполнении Eden. Живые объекты из Eden помечаются и копируются (_уплотнение и копирование_)
          в S0, из S0 в S1, из S1 в Tenured.
        - Большая сборка: при заполнении Tenured. Запускается вместе с малой. Используется сборка типа _
          __Mark-Sweep-Compact__ (_оставшиеся уплотняются_).
3. __Parallel GC__. Память устроена так же как и в __Serial GC__. Отличается только использование многопоточности. В
   несколько поток запускает перенос объектов по областям памяти. Тот же Stop The World.
4. __Concurrent Mark Sweep GC (CMS)__. Default до Java8. Малая сборка такая же. Большая сборка частично в фоновом
   режиме. Малая и большая сборки разнесены по времени. Большая сборка постоянно в фоновом режиме, не дожидаясь
   заполнения. Применяется подход __Snapshot-At-The-Beginning (SATB)__: остановились, пометили живые объекты напрямую
   доступные
   из корней, восстановились и в фоне помечаем все живые объекты, снова пауза, добавляем все, что появилось в процессе
   работы
   раз, восстановились и в фоне все удаляем. Объекты удаляются, но не уплотняются, что приводит к сильной фрагментации в
   старшем поколении.
5. __G1 GC__. Default с Java9. Так же использует __Snapshot-At-The-Beginning (SATB)__.
    - Принцип работы: память делится на небольшие равные области памяти + _Громадные регионы_ (для очень больших
      объектов).
    - Малая сборка: аналогичный принцип с Parallel / CMS, но проводится только на некоторых регионах, а не все поколении.
      Сборщик определяет, в каких регионах находится наибольшее количество мусора. 

## Примечания:
- Большие объекты создаются сразу в старом поколении, из-за невыгодности перемешать их в памяти


## Ресурсы:
- [youtube.com/watch?v=PA8z44ludgc](htpps://www.youtube.com/watch?v=PA8z44ludgc)